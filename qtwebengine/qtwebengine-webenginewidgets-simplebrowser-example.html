<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<!-- simplebrowser.qdoc -->
  <title>WebEngine Widgets Simple Browser Example | Qt WebEngine 5.7</title>
  <link rel="stylesheet" type="text/css" href="style/offline-simple.css" />
  <script type="text/javascript">
    window.onload = function(){document.getElementsByTagName("link").item(0).setAttribute("href", "style/offline.css");};
  </script>
</head>
<body>
<div class="header" id="qtdocheader">
  <div class="main">
    <div class="main-rounded">
      <div class="navigationbar">
        <table><tr>
<td ><a href="../qtdoc/supported-platforms-and-configurations.html#qt-5-7">Qt 5.7</a></td><td ><a href="qtwebengine-index.html">Qt WebEngine</a></td><td >WebEngine Widgets Simple Browser Example</td></tr></table><table class="buildversion"><tr>
<td id="buildversion" width="100%" align="right">Qt 5.7.0 参考文档</td>
        </tr></table>
      </div>
    </div>
<div class="content">
<div class="line">
<div class="content mainContent">
<div class="sidebar">
<div class="toc">
<h3><a name="toc">目录</a></h3>
<ul>
<li class="level1"><a href="#running-the-example">Running the Example</a></li>
<li class="level1"><a href="#class-hierarchy">Class Hierarchy</a></li>
<li class="level1"><a href="#creating-the-browser-main-window">Creating the Browser Main Window</a></li>
<li class="level1"><a href="#creating-tabs">Creating Tabs</a></li>
<li class="level1"><a href="#implementing-webview-functionality">Implementing WebView Functionality</a></li>
<li class="level2"><a href="#displaying-error-messages">Displaying Error Messages</a></li>
<li class="level2"><a href="#managing-webwindows">Managing WebWindows</a></li>
<li class="level2"><a href="#adding-context-menu-items">Adding Context Menu Items</a></li>
<li class="level1"><a href="#implementing-webpage-functionality">Implementing WebPage Functionality</a></li>
<li class="level1"><a href="#opening-a-web-page">Opening a Web Page</a></li>
</ul>
</div>
<div class="sidebar-content" id="sidebar-content"></div></div>
<h1 class="title">WebEngine Widgets Simple Browser Example</h1>
<span class="subtitle"></span>
<!-- $$$webenginewidgets/simplebrowser-description -->
<div class="descr"> <a name="details"></a>
<p class="centerAlign"><img src="images/simplebrowser.png" alt="" /></p><p><i>Simple Browser</i> demonstrates how to use the <a href="qtwebenginewidgets-module.html">Qt WebEngine C++ classes</a> to develop a small Web browser application that contains the following elements:</p>
<ul>
<li>Menu bar for opening stored pages and managing windows and tabs.</li>
<li>Navigation bar for entering a URL and for moving backward and forward in the web page browsing history.</li>
<li>Multi-tab area for displaying web content within tabs.</li>
<li>Status bar for displaying hovered links.</li>
</ul>
<p>The web content can be opened in new tabs or separate windows. HTTP and proxy authentication can be used for accessing web pages.</p>
<a name="running-the-example"></a>
<h2 id="running-the-example">Running the Example</h2>
<p>To run the example from <a href="http://doc.qt.io/qtcreator/index.html">Qt Creator</a>, open the <b>Welcome</b> mode and select the example from <b>Examples</b>. For more information, visit <a href="http://doc.qt.io/qtcreator/creator-build-example-application.html">Building and Running an Example</a>.</p>
<a name="class-hierarchy"></a>
<h2 id="class-hierarchy">Class Hierarchy</h2>
<p>We start with sketching a diagram of the classes that we are going to implement:</p>
<p class="centerAlign"><img src="images/simplebrowser-model.png" alt="" /></p><ul>
<li><code>Browser</code> is a singleton class managing the application windows.</li>
<li><code>BrowserWindow</code> is a <a href="../qtwidgets/qmainwindow.html">QMainWindow</a> showing the menu, a navigation bar, <code>TabWidget</code>, and a status bar.</li>
<li><code>TabWidget</code> is a <a href="../qtwidgets/qtabwidget.html">QTabWidget</a> and contains one or multiple browser tabs.</li>
<li><code>WebView</code> is a <a href="qwebengineview.html">QWebEngineView</a>, provides a view for <code>WebPage</code>, and is added as a tab in <code>TabWidget</code>.</li>
<li><code>WebPage</code> is a <a href="qwebenginepage.html">QWebEnginePage</a> that represents website content.</li>
</ul>
<a name="creating-the-browser-main-window"></a>
<h2 id="creating-the-browser-main-window">Creating the Browser Main Window</h2>
<p>This example supports multiple main windows that are owned by a <code>Browser</code> singleton object. This class could also be used for further functionality, such as downloading files, bookmarks, and history managers.</p>
<p>In <code>main.cpp</code>, we create the first <code>BrowserWindow</code> instance and add it to the <code>Browser</code> object. If no arguments are passed on the command line, we open the <a href="http://qt.io/">Qt Homepage</a>:</p>
<pre class="qml">

  <span class="type">int</span> main(<span class="type">int</span> argc<span class="operator">,</span> <span class="type">char</span> <span class="operator">*</span><span class="operator">*</span>argv)
  {
      <span class="type"><a href="../qtwidgets/qapplication.html">QApplication</a></span> app(argc<span class="operator">,</span> argv);
      app<span class="operator">.</span>setWindowIcon(<span class="type"><a href="../qtgui/qicon.html">QIcon</a></span>(QLatin1String(<span class="string">&quot;:simplebrowser.svg&quot;</span>)));

      BrowserWindow <span class="operator">*</span>window <span class="operator">=</span> <span class="keyword">new</span> BrowserWindow();
      Browser<span class="operator">::</span>instance()<span class="operator">.</span>addWindow(window);

      <span class="keyword">const</span> <span class="type"><a href="../qtcore/qstring.html">QString</a></span> url <span class="operator">=</span> getCommandLineUrlArgument();
      <span class="keyword">if</span> (<span class="operator">!</span>url<span class="operator">.</span>isEmpty())
          window<span class="operator">-</span><span class="operator">&gt;</span>loadPage(url);
      <span class="keyword">else</span>
          window<span class="operator">-</span><span class="operator">&gt;</span>loadHomePage();

      <span class="keyword">return</span> app<span class="operator">.</span>exec();
  }

</pre>
<a name="creating-tabs"></a>
<h2 id="creating-tabs">Creating Tabs</h2>
<p>The <code>BrowserWindow</code> constructor initializes all the necessary user interface related objects. The <code>centralWidget</code> of <code>BrowserWindow</code> contains an instance of <code>TabWidget</code>. The <code>TabWidget</code> contains one or several <code>WebView</code> instances as tabs, and delegates it's signals and slots to the currently selected one:</p>
<pre class="qml">

  <span class="keyword">class</span> TabWidget : <span class="keyword">public</span> <span class="type"><a href="../qtwidgets/qtabwidget.html">QTabWidget</a></span>
  {
      ...
  <span class="keyword">signals</span>:
      <span class="comment">// current tab/page signals</span>
      <span class="type">void</span> linkHovered(<span class="keyword">const</span> <span class="type"><a href="../qtcore/qstring.html">QString</a></span> <span class="operator">&amp;</span>link);
      <span class="type">void</span> loadProgress(<span class="type">int</span> progress);
      <span class="type">void</span> titleChanged(<span class="keyword">const</span> <span class="type"><a href="../qtcore/qstring.html">QString</a></span> <span class="operator">&amp;</span>title);
      <span class="type">void</span> urlChanged(<span class="keyword">const</span> <span class="type"><a href="../qtcore/qurl.html">QUrl</a></span> <span class="operator">&amp;</span>url);
      <span class="type">void</span> iconChanged(<span class="keyword">const</span> <span class="type"><a href="../qtgui/qicon.html">QIcon</a></span> <span class="operator">&amp;</span>icon);
      <span class="type">void</span> webActionEnabledChanged(<span class="type"><a href="qwebenginepage.html">QWebEnginePage</a></span><span class="operator">::</span>WebAction action<span class="operator">,</span> bool enabled);

  <span class="keyword">public</span> <span class="keyword">slots</span>:
      <span class="comment">// current tab/page slots</span>
      <span class="type">void</span> setUrl(<span class="keyword">const</span> <span class="type"><a href="../qtcore/qurl.html">QUrl</a></span> <span class="operator">&amp;</span>url);
      <span class="type">void</span> triggerWebPageAction(<span class="type"><a href="qwebenginepage.html">QWebEnginePage</a></span><span class="operator">::</span>WebAction action);

      ...
  };

</pre>
<p>Each tab contains an instance of <code>WebView</code>:</p>
<pre class="qml">

  WebView <span class="operator">*</span>TabWidget<span class="operator">::</span>createTab(bool makeCurrent)
  {
      WebView <span class="operator">*</span>webView <span class="operator">=</span> <span class="keyword">new</span> WebView;
      WebPage <span class="operator">*</span>webPage <span class="operator">=</span> <span class="keyword">new</span> WebPage(<span class="type"><a href="qwebengineprofile.html">QWebEngineProfile</a></span><span class="operator">::</span>defaultProfile()<span class="operator">,</span> webView);
      webView<span class="operator">-</span><span class="operator">&gt;</span>setPage(webPage);
      setupView(webView);
      addTab(webView<span class="operator">,</span> tr(<span class="string">&quot;(Untitled)&quot;</span>));
      <span class="keyword">if</span> (makeCurrent)
          setCurrentWidget(webView);
      <span class="keyword">return</span> webView;
  }

</pre>
<p>In <code>TabWidget::setupView()</code>, we make sure that the <code>TabWidget</code> always forwards the signals of the currently selected <code>WebView</code>:</p>
<pre class="qml">

  <span class="type">void</span> TabWidget<span class="operator">::</span>setupView(WebView <span class="operator">*</span>webView)
  {
      <span class="type"><a href="qwebenginepage.html">QWebEnginePage</a></span> <span class="operator">*</span>webPage <span class="operator">=</span> webView<span class="operator">-</span><span class="operator">&gt;</span>page();

      connect(webView<span class="operator">,</span> <span class="operator">&amp;</span><span class="type"><a href="qwebengineview.html">QWebEngineView</a></span><span class="operator">::</span>titleChanged<span class="operator">,</span> <span class="operator">[</span><span class="keyword">this</span><span class="operator">,</span> webView<span class="operator">]</span>(<span class="keyword">const</span> <span class="type"><a href="../qtcore/qstring.html">QString</a></span> <span class="operator">&amp;</span>title) {
          <span class="type">int</span> index <span class="operator">=</span> indexOf(webView);
          <span class="keyword">if</span> (index <span class="operator">!</span><span class="operator">=</span> <span class="operator">-</span><span class="number">1</span>)
              setTabText(index<span class="operator">,</span> title);
          <span class="keyword">if</span> (currentIndex() <span class="operator">=</span><span class="operator">=</span> index)
              <span class="keyword">emit</span> titleChanged(title);
      });
      connect(webView<span class="operator">,</span> <span class="operator">&amp;</span><span class="type"><a href="qwebengineview.html">QWebEngineView</a></span><span class="operator">::</span>urlChanged<span class="operator">,</span> <span class="operator">[</span><span class="keyword">this</span><span class="operator">,</span> webView<span class="operator">]</span>(<span class="keyword">const</span> <span class="type"><a href="../qtcore/qurl.html">QUrl</a></span> <span class="operator">&amp;</span>url) {
          <span class="type">int</span> index <span class="operator">=</span> indexOf(webView);
          <span class="keyword">if</span> (index <span class="operator">!</span><span class="operator">=</span> <span class="operator">-</span><span class="number">1</span>)
              tabBar()<span class="operator">-</span><span class="operator">&gt;</span>setTabData(index<span class="operator">,</span> url);
          <span class="keyword">if</span> (currentIndex() <span class="operator">=</span><span class="operator">=</span> index)
              <span class="keyword">emit</span> urlChanged(url);
      });
      connect(webView<span class="operator">,</span> <span class="operator">&amp;</span><span class="type"><a href="qwebengineview.html">QWebEngineView</a></span><span class="operator">::</span>loadProgress<span class="operator">,</span> <span class="operator">[</span><span class="keyword">this</span><span class="operator">,</span> webView<span class="operator">]</span>(<span class="type">int</span> progress) {
          <span class="keyword">if</span> (currentIndex() <span class="operator">=</span><span class="operator">=</span> indexOf(webView))
              <span class="keyword">emit</span> loadProgress(progress);
      });
      ...
  }

</pre>
<a name="implementing-webview-functionality"></a>
<h2 id="implementing-webview-functionality">Implementing WebView Functionality</h2>
<p>The <code>WebView</code> is derived from <a href="qwebengineview.html">QWebEngineView</a> to support the following functionality:</p>
<ul>
<li>Displaying error messages in case <code>renderProcess</code> dies</li>
<li>Handling <code>createWindow</code> requests</li>
<li>Adding custom menu items to context menus</li>
</ul>
<p>First, we create the <a href="../qtwebview/qml-qtwebview-webview.html">WebView</a> with the necessary methods and signals:</p>
<pre class="qml">

  <span class="keyword">class</span> WebView : <span class="keyword">public</span> <span class="type"><a href="qwebengineview.html">QWebEngineView</a></span>
  {
      Q_OBJECT

  <span class="keyword">public</span>:
      WebView(<span class="type"><a href="../qtwidgets/qwidget.html">QWidget</a></span> <span class="operator">*</span>parent <span class="operator">=</span> nullptr);
      ...
  <span class="keyword">protected</span>:
      <span class="type">void</span> contextMenuEvent(<span class="type"><a href="../qtgui/qcontextmenuevent.html">QContextMenuEvent</a></span> <span class="operator">*</span>event) override;
      <span class="type"><a href="qwebengineview.html">QWebEngineView</a></span> <span class="operator">*</span>createWindow(<span class="type"><a href="qwebenginepage.html">QWebEnginePage</a></span><span class="operator">::</span>WebWindowType type) override;

  <span class="keyword">signals</span>:
      <span class="type">void</span> webActionEnabledChanged(<span class="type"><a href="qwebenginepage.html">QWebEnginePage</a></span><span class="operator">::</span>WebAction webAction<span class="operator">,</span> bool enabled);

      ...
  };

</pre>
<a name="displaying-error-messages"></a>
<h3 >Displaying Error Messages</h3>
<p>If the render process is terminated, we display a <a href="../qtwidgets/qmessagebox.html">QMessageBox</a> with an error code, and then we reload the page:</p>
<pre class="qml">

  WebView<span class="operator">::</span>WebView(<span class="type"><a href="../qtwidgets/qwidget.html">QWidget</a></span> <span class="operator">*</span>parent)
      : <span class="type"><a href="qwebengineview.html">QWebEngineView</a></span>(parent)
      <span class="operator">,</span> m_loadProgress(<span class="number">0</span>)
  {
      ...
      connect(<span class="keyword">this</span><span class="operator">,</span> <span class="operator">&amp;</span><span class="type"><a href="qwebengineview.html">QWebEngineView</a></span><span class="operator">::</span>renderProcessTerminated<span class="operator">,</span>
              <span class="operator">[</span><span class="keyword">this</span><span class="operator">]</span>(<span class="type"><a href="qwebenginepage.html">QWebEnginePage</a></span><span class="operator">::</span>RenderProcessTerminationStatus termStatus<span class="operator">,</span> <span class="type">int</span> statusCode) {
          <span class="type"><a href="../qtcore/qstring.html">QString</a></span> status;
          <span class="keyword">switch</span> (termStatus) {
          <span class="keyword">case</span> <span class="type"><a href="qwebenginepage.html">QWebEnginePage</a></span><span class="operator">::</span>NormalTerminationStatus:
              status <span class="operator">=</span> tr(<span class="string">&quot;Render process normal exit&quot;</span>);
              <span class="keyword">break</span>;
          <span class="keyword">case</span> <span class="type"><a href="qwebenginepage.html">QWebEnginePage</a></span><span class="operator">::</span>AbnormalTerminationStatus:
              status <span class="operator">=</span> tr(<span class="string">&quot;Render process abnormal exit&quot;</span>);
              <span class="keyword">break</span>;
          <span class="keyword">case</span> <span class="type"><a href="qwebenginepage.html">QWebEnginePage</a></span><span class="operator">::</span>CrashedTerminationStatus:
              status <span class="operator">=</span> tr(<span class="string">&quot;Render process crashed&quot;</span>);
              <span class="keyword">break</span>;
          <span class="keyword">case</span> <span class="type"><a href="qwebenginepage.html">QWebEnginePage</a></span><span class="operator">::</span>KilledTerminationStatus:
              status <span class="operator">=</span> tr(<span class="string">&quot;Render process killed&quot;</span>);
              <span class="keyword">break</span>;
          }
          <span class="type"><a href="../qtwidgets/qmessagebox.html">QMessageBox</a></span><span class="operator">::</span>StandardButton btn <span class="operator">=</span> <span class="type"><a href="../qtwidgets/qmessagebox.html">QMessageBox</a></span><span class="operator">::</span>question(window()<span class="operator">,</span> status<span class="operator">,</span>
                                                     tr(<span class="string">&quot;Render process exited with code: %1\n&quot;</span>
                                                        <span class="string">&quot;Do you want to reload the page ?&quot;</span>)<span class="operator">.</span>arg(statusCode));
          <span class="keyword">if</span> (btn <span class="operator">=</span><span class="operator">=</span> <span class="type"><a href="../qtwidgets/qmessagebox.html">QMessageBox</a></span><span class="operator">::</span>Yes)
              <span class="type"><a href="../qtcore/qtimer.html">QTimer</a></span><span class="operator">::</span>singleShot(<span class="number">0</span><span class="operator">,</span> <span class="operator">[</span><span class="keyword">this</span><span class="operator">]</span> { reload(); });
      });
  }

</pre>
<a name="managing-webwindows"></a>
<h3 >Managing WebWindows</h3>
<p>The loaded page might want to create windows of the type <a href="qwebenginepage.html#WebWindowType-enum">QWebEnginePage::WebWindowType</a>, for example, when a JavaScript program requests to open a document in a new window or dialog. This is handled by overriding <code>QWebView::createWindow()</code>:</p>
<pre class="qml">

  <span class="type"><a href="qwebengineview.html">QWebEngineView</a></span> <span class="operator">*</span>WebView<span class="operator">::</span>createWindow(<span class="type"><a href="qwebenginepage.html">QWebEnginePage</a></span><span class="operator">::</span>WebWindowType type)
  {
      <span class="keyword">switch</span> (type) {
      <span class="keyword">case</span> <span class="type"><a href="qwebenginepage.html">QWebEnginePage</a></span><span class="operator">::</span>WebBrowserTab: {
          BrowserWindow <span class="operator">*</span>mainWindow <span class="operator">=</span> qobject_cast<span class="operator">&lt;</span>BrowserWindow<span class="operator">*</span><span class="operator">&gt;</span>(window());
          <span class="keyword">return</span> mainWindow<span class="operator">-</span><span class="operator">&gt;</span>tabWidget()<span class="operator">-</span><span class="operator">&gt;</span>createTab();
      }
      <span class="keyword">case</span> <span class="type"><a href="qwebenginepage.html">QWebEnginePage</a></span><span class="operator">::</span>WebBrowserBackgroundTab: {
          BrowserWindow <span class="operator">*</span>mainWindow <span class="operator">=</span> qobject_cast<span class="operator">&lt;</span>BrowserWindow<span class="operator">*</span><span class="operator">&gt;</span>(window());
          <span class="keyword">return</span> mainWindow<span class="operator">-</span><span class="operator">&gt;</span>tabWidget()<span class="operator">-</span><span class="operator">&gt;</span>createTab(<span class="keyword">false</span>);
      }
      <span class="keyword">case</span> <span class="type"><a href="qwebenginepage.html">QWebEnginePage</a></span><span class="operator">::</span>WebBrowserWindow: {
          BrowserWindow <span class="operator">*</span>mainWindow <span class="operator">=</span> <span class="keyword">new</span> BrowserWindow();
          Browser<span class="operator">::</span>instance()<span class="operator">.</span>addWindow(mainWindow);
          <span class="keyword">return</span> mainWindow<span class="operator">-</span><span class="operator">&gt;</span>currentTab();
      }
      <span class="keyword">case</span> <span class="type"><a href="qwebenginepage.html">QWebEnginePage</a></span><span class="operator">::</span>WebDialog: {
          WebPopupWindow <span class="operator">*</span>popup <span class="operator">=</span> <span class="keyword">new</span> WebPopupWindow(page()<span class="operator">-</span><span class="operator">&gt;</span>profile());
          <span class="keyword">return</span> popup<span class="operator">-</span><span class="operator">&gt;</span>view();
      }
      }
      <span class="keyword">return</span> nullptr;
  }

</pre>
<p>In case of <code>QWebEnginePage::WebDialog</code>, we create an instance of a custom <code>WebPopupWindow</code> class:</p>
<pre class="qml">

  <span class="keyword">class</span> WebPopupWindow : <span class="keyword">public</span> <span class="type"><a href="../qtwidgets/qwidget.html">QWidget</a></span>
  {
      Q_OBJECT

  <span class="keyword">public</span>:
      WebPopupWindow(<span class="type"><a href="qwebengineprofile.html">QWebEngineProfile</a></span> <span class="operator">*</span>profile);
      <span class="type"><a href="qwebengineview.html">QWebEngineView</a></span> <span class="operator">*</span>view() <span class="keyword">const</span>;
      <span class="type">void</span> setUrl(<span class="keyword">const</span> <span class="type"><a href="../qtcore/qurl.html">QUrl</a></span> <span class="operator">&amp;</span>url);

  <span class="keyword">private</span> <span class="keyword">slots</span>:
      <span class="type">void</span> handleGeometryChangeRequested(<span class="keyword">const</span> <span class="type"><a href="../qtcore/qrect.html">QRect</a></span> <span class="operator">&amp;</span>newGeometry);
      <span class="type">void</span> handleIconChanged(<span class="keyword">const</span> <span class="type"><a href="../qtgui/qicon.html">QIcon</a></span> <span class="operator">&amp;</span>icon);

  <span class="keyword">private</span>:
      UrlLineEdit <span class="operator">*</span>m_addressBar;
      WebView <span class="operator">*</span>m_view;
  };

</pre>
<a name="adding-context-menu-items"></a>
<h3 >Adding Context Menu Items</h3>
<p>We add menu items to the context menu, so that users can right-click a link to have it opened in the same tab, a new window, or a new tab. We override <a href="qwebengineview.html#contextMenuEvent">QWebEngineView::contextMenuEvent</a> and use <a href="qwebenginepage.html#createStandardContextMenu">QWebEnginePage::createStandardContextMenu</a> to create a default <a href="../qtwidgets/qmenu.html">QMenu</a> with a default list of <a href="qwebenginepage.html#WebAction-enum">QWebEnginePage::WebAction</a> actions.</p>
<p>The default name for <a href="qwebenginepage.html#WebAction-enum">QWebEnginePage::OpenLinkInThisWindow</a> action is <b>Follow</b>. For clarity, we rename it <b>Open Link in This Tab</b>. Also, we add the actions for opening links in a separate window or in a new tab:</p>
<pre class="qml">

  <span class="type">void</span> WebView<span class="operator">::</span>contextMenuEvent(<span class="type"><a href="../qtgui/qcontextmenuevent.html">QContextMenuEvent</a></span> <span class="operator">*</span>event)
  {
      <span class="type"><a href="../qtwidgets/qmenu.html">QMenu</a></span> <span class="operator">*</span>menu <span class="operator">=</span> page()<span class="operator">-</span><span class="operator">&gt;</span>createStandardContextMenu();
      <span class="keyword">const</span> <span class="type"><a href="../qtcore/qlist.html">QList</a></span><span class="operator">&lt;</span><span class="type"><a href="../qtwidgets/qaction.html">QAction</a></span><span class="operator">*</span><span class="operator">&gt;</span> actions <span class="operator">=</span> menu<span class="operator">-</span><span class="operator">&gt;</span>actions();
      <span class="keyword">auto</span> it <span class="operator">=</span> std<span class="operator">::</span>find(actions<span class="operator">.</span>cbegin()<span class="operator">,</span> actions<span class="operator">.</span>cend()<span class="operator">,</span> page()<span class="operator">-</span><span class="operator">&gt;</span>action(<span class="type"><a href="qwebenginepage.html">QWebEnginePage</a></span><span class="operator">::</span>OpenLinkInThisWindow));
      <span class="keyword">if</span> (it <span class="operator">!</span><span class="operator">=</span> actions<span class="operator">.</span>cend()) {
          (<span class="operator">*</span>it)<span class="operator">-</span><span class="operator">&gt;</span>setText(tr(<span class="string">&quot;Open Link in This Tab&quot;</span>));
          <span class="operator">+</span><span class="operator">+</span>it;
          <span class="type"><a href="../qtwidgets/qaction.html">QAction</a></span> <span class="operator">*</span>before(it <span class="operator">=</span><span class="operator">=</span> actions<span class="operator">.</span>cend() <span class="operator">?</span> nullptr : <span class="operator">*</span>it);
          menu<span class="operator">-</span><span class="operator">&gt;</span>insertAction(before<span class="operator">,</span> page()<span class="operator">-</span><span class="operator">&gt;</span>action(<span class="type"><a href="qwebenginepage.html">QWebEnginePage</a></span><span class="operator">::</span>OpenLinkInNewWindow));
          menu<span class="operator">-</span><span class="operator">&gt;</span>insertAction(before<span class="operator">,</span> page()<span class="operator">-</span><span class="operator">&gt;</span>action(<span class="type"><a href="qwebenginepage.html">QWebEnginePage</a></span><span class="operator">::</span>OpenLinkInNewTab));
      }
      connect(menu<span class="operator">,</span> <span class="operator">&amp;</span><span class="type"><a href="../qtwidgets/qmenu.html">QMenu</a></span><span class="operator">::</span>aboutToHide<span class="operator">,</span> menu<span class="operator">,</span> <span class="operator">&amp;</span><span class="type"><a href="../qtcore/qobject.html">QObject</a></span><span class="operator">::</span>deleteLater);
      menu<span class="operator">-</span><span class="operator">&gt;</span>popup(event<span class="operator">-</span><span class="operator">&gt;</span>globalPos());
  }

</pre>
<a name="implementing-webpage-functionality"></a>
<h2 id="implementing-webpage-functionality">Implementing WebPage Functionality</h2>
<p>As mentioned earlier, each <code>WebView</code> contains a <code>WebPage</code> instance that was created by using <a href="qwebengineprofile.html#defaultProfile">QWebEngineProfile::defaultProfile</a>().</p>
<p>We implement <code>WebPage</code> as a subclass of <a href="qwebenginepage.html">QWebEnginePage</a> to enable HTTP, proxy authentication, and ignoring SSL certificate errors when accessing web pages:</p>
<pre class="qml">

  <span class="keyword">class</span> WebPage : <span class="keyword">public</span> <span class="type"><a href="qwebenginepage.html">QWebEnginePage</a></span>
  {
      Q_OBJECT

  <span class="keyword">public</span>:
      WebPage(<span class="type"><a href="qwebengineprofile.html">QWebEngineProfile</a></span> <span class="operator">*</span>profile<span class="operator">,</span> <span class="type"><a href="../qtcore/qobject.html">QObject</a></span> <span class="operator">*</span>parent <span class="operator">=</span> nullptr);

  <span class="keyword">protected</span>:
      bool certificateError(<span class="keyword">const</span> <span class="type"><a href="qwebenginecertificateerror.html">QWebEngineCertificateError</a></span> <span class="operator">&amp;</span>error) override;

  <span class="keyword">private</span> <span class="keyword">slots</span>:
      <span class="type">void</span> handleAuthenticationRequired(<span class="keyword">const</span> <span class="type"><a href="../qtcore/qurl.html">QUrl</a></span> <span class="operator">&amp;</span>requestUrl<span class="operator">,</span> <span class="type"><a href="../qtnetwork/qauthenticator.html">QAuthenticator</a></span> <span class="operator">*</span>auth);
      <span class="type">void</span> handleProxyAuthenticationRequired(<span class="keyword">const</span> <span class="type"><a href="../qtcore/qurl.html">QUrl</a></span> <span class="operator">&amp;</span>requestUrl<span class="operator">,</span> <span class="type"><a href="../qtnetwork/qauthenticator.html">QAuthenticator</a></span> <span class="operator">*</span>auth<span class="operator">,</span> <span class="keyword">const</span> <span class="type"><a href="../qtcore/qstring.html">QString</a></span> <span class="operator">&amp;</span>proxyHost);
  };

</pre>
<p>In all the cases above, we display the appropriate dialog to the user. In case of authentication, we need to set the correct credential values on the <a href="../qtnetwork/qauthenticator.html">QAuthenticator</a> object:</p>
<pre class="qml">

  <span class="type">void</span> WebPage<span class="operator">::</span>handleAuthenticationRequired(<span class="keyword">const</span> <span class="type"><a href="../qtcore/qurl.html">QUrl</a></span> <span class="operator">&amp;</span>requestUrl<span class="operator">,</span> <span class="type"><a href="../qtnetwork/qauthenticator.html">QAuthenticator</a></span> <span class="operator">*</span>auth)
  {
      <span class="type"><a href="../qtwidgets/qwidget.html">QWidget</a></span> <span class="operator">*</span>mainWindow <span class="operator">=</span> view()<span class="operator">-</span><span class="operator">&gt;</span>window();
      <span class="type"><a href="../qtwidgets/qdialog.html">QDialog</a></span> dialog(mainWindow);
      dialog<span class="operator">.</span>setModal(<span class="keyword">true</span>);
      dialog<span class="operator">.</span>setWindowFlags(dialog<span class="operator">.</span>windowFlags() <span class="operator">&amp;</span> <span class="operator">~</span><span class="type"><a href="../qtcore/qt.html">Qt</a></span><span class="operator">::</span>WindowContextHelpButtonHint);

      Ui<span class="operator">::</span>PasswordDialog passwordDialog;
      passwordDialog<span class="operator">.</span>setupUi(<span class="operator">&amp;</span>dialog);

      passwordDialog<span class="operator">.</span>m_iconLabel<span class="operator">-</span><span class="operator">&gt;</span>setText(<span class="type"><a href="../qtcore/qstring.html">QString</a></span>());
      <span class="type"><a href="../qtgui/qicon.html">QIcon</a></span> icon(mainWindow<span class="operator">-</span><span class="operator">&gt;</span>style()<span class="operator">-</span><span class="operator">&gt;</span>standardIcon(<span class="type"><a href="../qtwidgets/qstyle.html">QStyle</a></span><span class="operator">::</span>SP_MessageBoxQuestion<span class="operator">,</span> <span class="number">0</span><span class="operator">,</span> mainWindow));
      passwordDialog<span class="operator">.</span>m_iconLabel<span class="operator">-</span><span class="operator">&gt;</span>setPixmap(icon<span class="operator">.</span>pixmap(<span class="number">32</span><span class="operator">,</span> <span class="number">32</span>));

      <span class="type"><a href="../qtcore/qstring.html">QString</a></span> introMessage(tr(<span class="string">&quot;Enter username and password for \&quot;%1\&quot; at %2&quot;</span>)
                           <span class="operator">.</span>arg(auth<span class="operator">-</span><span class="operator">&gt;</span>realm())<span class="operator">.</span>arg(requestUrl<span class="operator">.</span>toString()<span class="operator">.</span>toHtmlEscaped()));
      passwordDialog<span class="operator">.</span>m_infoLabel<span class="operator">-</span><span class="operator">&gt;</span>setText(introMessage);
      passwordDialog<span class="operator">.</span>m_infoLabel<span class="operator">-</span><span class="operator">&gt;</span>setWordWrap(<span class="keyword">true</span>);

      <span class="keyword">if</span> (dialog<span class="operator">.</span>exec() <span class="operator">=</span><span class="operator">=</span> <span class="type"><a href="../qtwidgets/qdialog.html">QDialog</a></span><span class="operator">::</span>Accepted) {
          auth<span class="operator">-</span><span class="operator">&gt;</span>setUser(passwordDialog<span class="operator">.</span>m_userNameLineEdit<span class="operator">-</span><span class="operator">&gt;</span>text());
          auth<span class="operator">-</span><span class="operator">&gt;</span>setPassword(passwordDialog<span class="operator">.</span>m_passwordLineEdit<span class="operator">-</span><span class="operator">&gt;</span>text());
      } <span class="keyword">else</span> {
          <span class="comment">// Set authenticator null if dialog is cancelled</span>
          <span class="operator">*</span>auth <span class="operator">=</span> <span class="type"><a href="../qtnetwork/qauthenticator.html">QAuthenticator</a></span>();
      }
  }

</pre>
<p>The <code>handleProxyAuthenticationRequired</code> signal handler implements the very same steps for the authentication of HTTP proxies.</p>
<p>In case of SSL errors, we just need to return a boolean value indicating whether the certificate should be ignored.</p>
<pre class="qml">

  bool WebPage<span class="operator">::</span>certificateError(<span class="keyword">const</span> <span class="type"><a href="qwebenginecertificateerror.html">QWebEngineCertificateError</a></span> <span class="operator">&amp;</span>error)
  {
      <span class="type"><a href="../qtwidgets/qwidget.html">QWidget</a></span> <span class="operator">*</span>mainWindow <span class="operator">=</span> view()<span class="operator">-</span><span class="operator">&gt;</span>window();
      <span class="keyword">if</span> (error<span class="operator">.</span>isOverridable()) {
          <span class="type"><a href="../qtwidgets/qdialog.html">QDialog</a></span> dialog(mainWindow);
          dialog<span class="operator">.</span>setModal(<span class="keyword">true</span>);
          dialog<span class="operator">.</span>setWindowFlags(dialog<span class="operator">.</span>windowFlags() <span class="operator">&amp;</span> <span class="operator">~</span><span class="type"><a href="../qtcore/qt.html">Qt</a></span><span class="operator">::</span>WindowContextHelpButtonHint);
          Ui<span class="operator">::</span>CertificateErrorDialog certificateDialog;
          certificateDialog<span class="operator">.</span>setupUi(<span class="operator">&amp;</span>dialog);
          certificateDialog<span class="operator">.</span>m_iconLabel<span class="operator">-</span><span class="operator">&gt;</span>setText(<span class="type"><a href="../qtcore/qstring.html">QString</a></span>());
          <span class="type"><a href="../qtgui/qicon.html">QIcon</a></span> icon(mainWindow<span class="operator">-</span><span class="operator">&gt;</span>style()<span class="operator">-</span><span class="operator">&gt;</span>standardIcon(<span class="type"><a href="../qtwidgets/qstyle.html">QStyle</a></span><span class="operator">::</span>SP_MessageBoxWarning<span class="operator">,</span> <span class="number">0</span><span class="operator">,</span> mainWindow));
          certificateDialog<span class="operator">.</span>m_iconLabel<span class="operator">-</span><span class="operator">&gt;</span>setPixmap(icon<span class="operator">.</span>pixmap(<span class="number">32</span><span class="operator">,</span> <span class="number">32</span>));
          certificateDialog<span class="operator">.</span>m_errorLabel<span class="operator">-</span><span class="operator">&gt;</span>setText(error<span class="operator">.</span>errorDescription());
          dialog<span class="operator">.</span>setWindowTitle(tr(<span class="string">&quot;Certificate Error&quot;</span>));
          <span class="keyword">return</span> dialog<span class="operator">.</span>exec() <span class="operator">=</span><span class="operator">=</span> <span class="type"><a href="../qtwidgets/qdialog.html">QDialog</a></span><span class="operator">::</span>Accepted;
      }

      <span class="type"><a href="../qtwidgets/qmessagebox.html">QMessageBox</a></span><span class="operator">::</span>critical(mainWindow<span class="operator">,</span> tr(<span class="string">&quot;Certificate Error&quot;</span>)<span class="operator">,</span> error<span class="operator">.</span>errorDescription());
      <span class="keyword">return</span> <span class="keyword">false</span>;
  }

</pre>
<a name="opening-a-web-page"></a>
<h2 id="opening-a-web-page">Opening a Web Page</h2>
<p>This section describes the workflow for opening a new page. When the user enters a URL in the navigation bar and presses <b>Enter</b>, <code>QLineEdit::returnPressed</code> is emitted, which lets <code>BrowserWindow</code> load the requested page:</p>
<pre class="qml">

      connect(m_urlLineEdit<span class="operator">,</span> <span class="operator">&amp;</span><span class="type"><a href="../qtwidgets/qlineedit.html">QLineEdit</a></span><span class="operator">::</span>returnPressed<span class="operator">,</span> <span class="keyword">this</span><span class="operator">,</span> <span class="operator">[</span><span class="keyword">this</span><span class="operator">]</span>() {
          m_urlLineEdit<span class="operator">-</span><span class="operator">&gt;</span>setFavIcon(<span class="type"><a href="../qtgui/qicon.html">QIcon</a></span>(<span class="type"><a href="../qtcore/qstring.html#QStringLiteral">QStringLiteral</a></span>(<span class="string">&quot;:defaulticon.png&quot;</span>)));
          loadPage(m_urlLineEdit<span class="operator">-</span><span class="operator">&gt;</span>url());
      });

</pre>
<p>The <code>loadPage()</code> method calls the <code>setUrl()</code> method of <code>TabWidget</code>:</p>
<pre class="qml">

  <span class="type">void</span> BrowserWindow<span class="operator">::</span>loadPage(<span class="keyword">const</span> <span class="type"><a href="../qtcore/qurl.html">QUrl</a></span> <span class="operator">&amp;</span>url)
  {
      <span class="keyword">if</span> (url<span class="operator">.</span>isValid()) {
          m_urlLineEdit<span class="operator">-</span><span class="operator">&gt;</span>setUrl(url);
          m_tabWidget<span class="operator">-</span><span class="operator">&gt;</span>setUrl(url);
      }
  }

</pre>
<p>The call is forwarded to the currently selected tab:</p>
<pre class="qml">

  <span class="type">void</span> TabWidget<span class="operator">::</span>setUrl(<span class="keyword">const</span> <span class="type"><a href="../qtcore/qurl.html">QUrl</a></span> <span class="operator">&amp;</span>url)
  {
      <span class="keyword">if</span> (WebView <span class="operator">*</span>view <span class="operator">=</span> currentWebView()) {
          view<span class="operator">-</span><span class="operator">&gt;</span>setUrl(url);
          view<span class="operator">-</span><span class="operator">&gt;</span>setFocus();
      }
  }

</pre>
<p>The <code>setUrl()</code> method of <code>WebView</code> just forwards the <code>url</code> to the associated <code>WebPage</code>, which in turn starts the downloading of the page's content in the background.</p>
<p>Files:</p>
<ul>
<li><a href="qtwebengine-webenginewidgets-simplebrowser-browser-cpp.html">webenginewidgets/simplebrowser/browser.cpp</a></li>
<li><a href="qtwebengine-webenginewidgets-simplebrowser-browser-h.html">webenginewidgets/simplebrowser/browser.h</a></li>
<li><a href="qtwebengine-webenginewidgets-simplebrowser-browserwindow-cpp.html">webenginewidgets/simplebrowser/browserwindow.cpp</a></li>
<li><a href="qtwebengine-webenginewidgets-simplebrowser-browserwindow-h.html">webenginewidgets/simplebrowser/browserwindow.h</a></li>
<li><a href="qtwebengine-webenginewidgets-simplebrowser-certificateerrordialog-ui.html">webenginewidgets/simplebrowser/certificateerrordialog.ui</a></li>
<li><a href="qtwebengine-webenginewidgets-simplebrowser-passworddialog-ui.html">webenginewidgets/simplebrowser/passworddialog.ui</a></li>
<li><a href="qtwebengine-webenginewidgets-simplebrowser-tabwidget-cpp.html">webenginewidgets/simplebrowser/tabwidget.cpp</a></li>
<li><a href="qtwebengine-webenginewidgets-simplebrowser-tabwidget-h.html">webenginewidgets/simplebrowser/tabwidget.h</a></li>
<li><a href="qtwebengine-webenginewidgets-simplebrowser-urllineedit-cpp.html">webenginewidgets/simplebrowser/urllineedit.cpp</a></li>
<li><a href="qtwebengine-webenginewidgets-simplebrowser-urllineedit-h.html">webenginewidgets/simplebrowser/urllineedit.h</a></li>
<li><a href="qtwebengine-webenginewidgets-simplebrowser-webpage-cpp.html">webenginewidgets/simplebrowser/webpage.cpp</a></li>
<li><a href="qtwebengine-webenginewidgets-simplebrowser-webpage-h.html">webenginewidgets/simplebrowser/webpage.h</a></li>
<li><a href="qtwebengine-webenginewidgets-simplebrowser-webpopupwindow-cpp.html">webenginewidgets/simplebrowser/webpopupwindow.cpp</a></li>
<li><a href="qtwebengine-webenginewidgets-simplebrowser-webpopupwindow-h.html">webenginewidgets/simplebrowser/webpopupwindow.h</a></li>
<li><a href="qtwebengine-webenginewidgets-simplebrowser-webview-cpp.html">webenginewidgets/simplebrowser/webview.cpp</a></li>
<li><a href="qtwebengine-webenginewidgets-simplebrowser-webview-h.html">webenginewidgets/simplebrowser/webview.h</a></li>
<li><a href="qtwebengine-webenginewidgets-simplebrowser-data-simplebrowser-svg.html">webenginewidgets/simplebrowser/data/simplebrowser.svg</a></li>
<li><a href="qtwebengine-webenginewidgets-simplebrowser-main-cpp.html">webenginewidgets/simplebrowser/main.cpp</a></li>
<li><a href="qtwebengine-webenginewidgets-simplebrowser-simplebrowser-pro.html">webenginewidgets/simplebrowser/simplebrowser.pro</a></li>
<li><a href="qtwebengine-webenginewidgets-simplebrowser-data-simplebrowser-qrc.html">webenginewidgets/simplebrowser/data/simplebrowser.qrc</a></li>
</ul>
</div>
<!-- @@@webenginewidgets/simplebrowser -->
        </div>
       </div>
   </div>
   </div>
</div>
<div class="footer">
   <p>
   <acronym title="Copyright">&copy;</acronym> 2016 The Qt Company Ltd.
   Documentation contributions included herein are the copyrights of
   their respective owners.<br>    The documentation provided herein is licensed under the terms of the    <a href="http://www.gnu.org/licenses/fdl.html">GNU Free Documentation    License version 1.3</a> as published by the Free Software Foundation.<br>    Qt and respective logos are trademarks of The Qt Company Ltd.     in Finland and/or other countries worldwide. All other trademarks are property
   of their respective owners. </p>
</div>
</body>
</html>
